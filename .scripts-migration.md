# Shell Script Extension Migration

This document records the migration from `.sh` to `.bash` extensions for clarity and proper tooling.

## Date
2025-11-08

## Rationale

Using distinct file extensions helps:
1. **Clarity**: Immediately know which shell dialect a script uses
2. **Tooling**: ShellCheck can apply appropriate dialect rules
3. **Standards**: Follow common practice where:
   - `.sh` = POSIX shell scripts (portable)
   - `.bash` = Bash scripts (uses Bash-specific features)

## Changes Made

### Files Renamed
- `cli/lib/common.sh` → `cli/lib/common.bash`
- `cli/lib/emacs.sh` → `cli/lib/emacs.bash`
- `cli/commands/doctor.sh` → `cli/commands/doctor.bash`
- `cli/commands/eval.sh` → `cli/commands/eval.bash`
- `cli/commands/run.sh` → `cli/commands/run.bash`

### Files Updated
All `source` statements updated to reference `.bash` files:
- `cli/jot` - Updated all command sourcing
- `cli/lib/emacs.bash` - Updated common.bash sourcing
- `cli/commands/*.bash` - Updated lib sourcing

### Configuration Files Created/Updated
1. **`.shellcheckrc`** - Created
   - Configures ShellCheck to treat `.sh` as POSIX sh
   - Enables all optional checks
   - Sets source path for finding sourced files

2. **`.editorconfig`** - Updated
   - Separated `[*.sh]` section with `shell_variant = posix`
   - Added `[*.bash]` section with `shell_variant = bash`

3. **`SHELL_CONVENTIONS.md`** - Created
   - Documents naming conventions
   - Provides best practices
   - Includes examples for both dialects
   - Migration checklist for future conversions

### Formatter Configuration
treefmt-nix (configured in `flake.nix`) automatically handles both:
- `*.sh` files via shfmt
- `*.bash` files via shfmt

Both are formatted with 2-space indentation.

## Verification

All functionality tested and working:
```bash
$ nix develop --command jot eval '(+ 5 10 15)'
30 ✓

$ nix develop --command jot doctor
Health check passed! ✓

$ nix develop --command just test-dev
Ran 11 tests, 11 results as expected ✓

$ nix develop --command just fmt
formatted 6 files (0 changed) ✓
```

## Future Guidelines

1. **New Scripts**:
   - Use `.bash` if you need Bash features (arrays, `[[]]`, etc.)
   - Use `.sh` only if script must be POSIX portable

2. **Existing Scripts**:
   - All CLI scripts are Bash and use `.bash` extension
   - No `.sh` files exist currently in the project

3. **CI/CD**:
   - ShellCheck will enforce appropriate dialect rules
   - treefmt formats both `.sh` and `.bash` files
   - GitHub Actions CI validates formatting

## Related Documentation
- `SHELL_CONVENTIONS.md` - Detailed conventions and best practices
- `FORMATTING.md` - Overall formatting guidelines
- `.shellcheckrc` - ShellCheck configuration
- `.editorconfig` - Editor formatting hints
